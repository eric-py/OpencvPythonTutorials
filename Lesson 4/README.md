# روش‌های ترکیب تصاویر با OpenCV

بررسی و مقایسه روش‌های مختلف ترکیب تصاویر با استفاده از کتابخانه OpenCV که هدف اصلی آن، درک عمیق‌تر تکنیک‌های مختلف ترکیب تصاویر و مقایسه نتایج آنها است.

## پیش‌نیاز
```bash
pip install opencv-python
```

## توضیح روش‌ها

### ۱. آماده‌سازی تصاویر
OpenCV تصاویر را به صورت ماتریس‌های سه‌بعدی در فضای رنگی BGR ذخیره می‌کند. در این پروژه از دو تصویر استفاده می‌کنیم:
- تصویر دایره به عنوان تصویر پایه
- تصویر رعد و برق برای ترکیب

### ۲. روش‌های ترکیب

#### الف) ترکیب ساده (جمع پیکسل به پیکسل)
```python
basic_addition = circle_image + lightning_image
```
- **نحوه عملکرد**: جمع مستقیم مقادیر متناظر پیکسل‌ها
- **چالش‌ها**: 
  - سرریز مقادیر بیشتر از 255
  - ایجاد رنگ‌های غیرطبیعی و نویز
- **محدودیت‌ها**: مناسب برای تصاویر با روشنایی کم

#### ب) ترکیب با تابع OpenCV
```python
opencv_addition = cv.add(circle_image, lightning_image)
```
- **نحوه عملکرد**: استفاده از تابع add با قابلیت اشباع
- **مزایا**:
  - کنترل سرریز با روش اشباع (حداکثر 255)
  - نتایج طبیعی‌تر و قابل پیش‌بینی
- **کاربردها**: ترکیب عمومی تصاویر بدون نیاز به کنترل دقیق

#### ج) ترکیب وزن‌دار
```python
weighted_blend = cv.addWeighted(circle_image, 0.8, lightning_image, 0.2, 0)
```
- **پارامترها**:
  - ضریب 0.8 برای تصویر اول (80% تاثیر)
  - ضریب 0.2 برای تصویر دوم (20% تاثیر)
  - gamma=0 برای حفظ روشنایی اصلی
- **مزایا**:
  - کنترل دقیق سهم هر تصویر
  - امکان ایجاد جلوه‌های تدریجی
  - نتایج نرم و طبیعی
- **کاربردها**: 
  - ایجاد جلوه‌های محو (fade)
  - ترکیب با نسبت‌های مشخص

#### د) ترکیب با ماسک
```python
# تبدیل به سیاه و سفید و ایجاد ماسک
gray_lightning = cv.cvtColor(lightning_image, cv.COLOR_BGR2GRAY)
_, binary_mask = cv.threshold(gray_lightning, 60, 250, cv.THRESH_BINARY)
inverted_mask = cv.bitwise_not(binary_mask)

# اعمال ماسک و ترکیب
masked_circle = cv.bitwise_and(circle_image, circle_image, mask=inverted_mask)
masked_lightning = cv.bitwise_and(lightning_image, lightning_image, mask=binary_mask)
final_composite = cv.add(masked_circle, masked_lightning)
```
- **مراحل**:
  1. تبدیل تصویر به سیاه و سفید
  2. ایجاد ماسک باینری با آستانه 60
  3. ایجاد ماسک معکوس برای پس‌زمینه
  4. اعمال ماسک‌ها روی تصاویر اصلی
  5. ترکیب نهایی تصاویر ماسک‌شده
- **مزایا**:
  - کنترل دقیق نواحی ترکیب
  - حفظ جزئیات مهم
  - امکان ترکیب پیچیده و انتخابی
- **کاربردها**:
  - جایگزینی هوشمند پس‌زمینه
  - ترکیب پیشرفته تصاویر
  - ایجاد جلوه‌های ویژه حرفه‌ای

## نکات پیشرفته
- استفاده از آستانه مناسب در تابع threshold برای ایجاد ماسک باینری
- اهمیت انتخاب وزن‌های مناسب در ترکیب وزن‌دار
- تاثیر پارامتر gamma در تنظیم روشنایی کلی
- اهمیت پیش‌پردازش تصاویر قبل از ترکیب

## جمع‌بندی
هر روش ترکیب، کاربردها و مزایای خاص خود را دارد:
- **ترکیب ساده**: سریع اما با محدودیت‌های جدی
- **ترکیب OpenCV**: متعادل و مناسب اکثر کاربردها
- **ترکیب وزن‌دار**: کنترل‌پذیر و انعطاف‌پذیر
- **ترکیب با ماسک**: پیشرفته و دقیق، مناسب کارهای حرفه‌ای